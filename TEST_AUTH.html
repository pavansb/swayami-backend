<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Test - Swayami</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Authentication Status Test</h1>
    
    <div class="status info">
        <h3>Testing Current Authentication State</h3>
        <p>This will check if you're actually authenticated despite any error messages.</p>
    </div>

    <button onclick="checkAuthStatus()">Check Authentication Status</button>
    <button onclick="clearAuth()">Clear Authentication</button>
    <button onclick="testDashboardRedirect()">Test Dashboard Redirect</button>

    <div id="results">
        <p>Click "Check Authentication Status" to test your current auth state.</p>
    </div>

    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://pbeborjasiiwuudfnzhm.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZWJvcmphc2lpd3V1ZGZuemhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2OTg5MDcsImV4cCI6MjA2NjI3NDkwN30.b6I79NZOQUM8mJpLO-k3tzdDrF20s5nSZ2clGLN5MNY';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }

        async function checkAuthStatus() {
            document.getElementById('results').innerHTML = '<p>Checking authentication status...</p>';
            
            try {
                // Check current session
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    log(`‚ùå Session Error: ${error.message}`, 'error');
                    return;
                }
                
                if (session && session.user) {
                    log(`‚úÖ AUTHENTICATED! Welcome, ${session.user.email}`, 'success');
                    log(`<strong>Session Details:</strong><br/>
                         User ID: ${session.user.id}<br/>
                         Email: ${session.user.email}<br/>
                         Name: ${session.user.user_metadata?.full_name || 'Not set'}<br/>
                         Last Sign In: ${new Date(session.user.last_sign_in_at).toLocaleString()}<br/>
                         <pre>${JSON.stringify(session.user.user_metadata, null, 2)}</pre>`, 'success');
                    
                    log(`üéâ <strong>GOOD NEWS:</strong> Your authentication is working! 
                         Despite any database errors, you are successfully logged in. 
                         The issue is just a Supabase database trigger that can be ignored.`, 'success');
                         
                    log(`<strong>Next Steps:</strong><br/>
                         1. You can now go to <a href="/dashboard">Dashboard</a><br/>
                         2. Or run the permanent fix in the Supabase dashboard<br/>
                         3. Your authentication is fully functional!`, 'info');
                } else {
                    log('üì≠ No active session found. You need to sign in.', 'info');
                    log(`<strong>To sign in:</strong><br/>
                         1. Go to <a href="/login">Login Page</a><br/>
                         2. Click "Sign in with Google"<br/>
                         3. Complete OAuth flow<br/>
                         4. Even if you see database errors, come back here to test`, 'info');
                }
                
            } catch (err) {
                log(`‚ùå Unexpected error: ${err.message}`, 'error');
            }
        }

        async function clearAuth() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) {
                    log(`‚ùå Sign out error: ${error.message}`, 'error');
                } else {
                    log('‚úÖ Successfully signed out', 'success');
                    document.getElementById('results').innerHTML = '<p>Cleared authentication. You can now test sign-in again.</p>';
                }
            } catch (err) {
                log(`‚ùå Unexpected error: ${err.message}`, 'error');
            }
        }

        function testDashboardRedirect() {
            log('üîÑ Testing dashboard redirect...', 'info');
            window.location.href = '/dashboard';
        }

        // Auto-check auth status when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkAuthStatus, 1000);
        });
    </script>
</body>
</html> 